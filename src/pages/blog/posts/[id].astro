---
// Disable prerendering since you want to use SSR
export const prerender = false;

import BlogApiClient, { type BlogPost } from "@/api/BlogClient";
import BlogLayout from "@/layouts/BlogLayout.astro";
import Post from "@/components/blog/Post.astro";

// Get the `id` from the URL params
const { id } = Astro.params;

let post: BlogPost | null = null;
let errorMessage: string | null = null;

if (!id) {
  errorMessage = "No ID provided";
} else {
  try {
    post = await new BlogApiClient().getPostById(id);

    if (!post) {
      errorMessage = "Post not found";
    }
  } catch (error) {
    console.error("Error fetching post:", error);
    errorMessage = "An error occurred while fetching the post. Please try again later.";
  }
}

if (errorMessage) {
  return new Response(errorMessage, {
    status: !post ? 404 : 500,
    statusText: errorMessage,
  });
}
---

<BlogLayout page={post!.title}>
  <article class="centered">
    <Post post={post!} size="large" showComments showContent />
  </article>
</BlogLayout>

<style lang="scss">
  .centered {
    display: flex;
    justify-content: center;
    align-items: center;
  }
</style>
